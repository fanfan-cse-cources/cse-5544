---
title: "dinofun_world"
output: html_document
date: "2022-12-08"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(lubridate)
library(dplyr)
library(ggplot2)
library(ggpubr)
```

## Message Frequency by Location/Hours (Sender)

```{r}
proc_data <- function(path) {
  dat <- subset(read.csv(file=path), select = -c(to))
  dat$from <- as.character(dat$from)
  dat$timestamp <- as.POSIXct(dat$timestamp, "%Y-%m-%d %H:%M:%S", tz = "")
  
  return(dat)
}
```

```{r}
# get message frequency by time
fri_combined <- proc_data("../outputs/comm-data-Fri.csv")
time_slot <- 8
location_filter <- c('Coaster Alley', 'Entry Corridor', 'Kiddie Land', 'Tundra Land', 'Wet Land')

res <- fri_combined %>%
  filter(hour(fri_combined$timestamp) == time_slot & location %in% location_filter) %>%
  group_by(from, location) %>%
  summarise(msg_freq = sum(to_num), .groups = 'keep') %>%
  arrange(desc(msg_freq)) %>%
  head(15)

a <- ggplot(data = res,
       mapping = aes(x = reorder(from, msg_freq), 
                     y = msg_freq,
                     fill = location)) +
  geom_col() +
  labs(x = "Sender UID", 
       y = "Message Frequency") +
  scale_y_log10() +
  coord_flip() +
  geom_text(aes(label = msg_freq), size = 3, hjust = 1.2)
```

```{r}
b <- ggplot(data = res, aes(x="", y=location, fill=location)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) +
  labs(fill = "Location") + 
  theme_void()

ggarrange(a, b, labels = c("A", "B"),
          common.legend = TRUE, legend = "bottom")
```
